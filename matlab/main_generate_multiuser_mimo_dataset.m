% main_generate_multiuser_mimo_dataset.m
clc; clear; close all;

% ===== Sweep 設定（依照論文或實驗需求調整）=====
K_list   = [4];           % 用戶數量
M_list   = [8];           % BS 天線數量
N_list   = [2];           % 每user天線數
Ns_list  = [1];           % 每user stream數
speeds   = [30, 120];     % 測試不同用戶移動速度
snrs     = [10, 30];      % 不同SNR
n_time   = 5000;          % 每組模擬時長
delta_t  = 1e-3;          % slot時間
fc       = 3.5e9;         % 載波頻率
seed     = 42;            % 隨機種子
CB_size  = 8;             % codebook數量(beam數，8/16/32都可)
save_dir = '../data/';    % 儲存路徑

for Ki = 1:length(K_list)
    for Mi = 1:length(M_list)
        for Ni = 1:length(N_list)
            for Nsi = 1:length(Ns_list)
                for si = 1:length(speeds)
                    for sj = 1:length(snrs)
                        params = struct( ...
                            'K',      K_list(Ki), ...
                            'M',      M_list(Mi), ...
                            'N',      N_list(Ni), ...
                            'Ns',     Ns_list(Nsi), ...
                            'T',      n_time, ...
                            'speed',  speeds(si), ...
                            'fc',     fc, ...
                            'snrdB',  snrs(sj), ...
                            'delta_t',delta_t, ...
                            'seed',   seed, ...
                            'CB_size',CB_size, ...
                            'filename', sprintf('%sbeam_dataset_K%d_M%d_N%d_Ns%d_speed%d_snr%d.csv', ...
                                save_dir, K_list(Ki), M_list(Mi), N_list(Ni), Ns_list(Nsi), speeds(si), snrs(sj)) ...
                        );
                        generate_beam_data_multiuser_mimo(params);
                    end
                end
            end
        end
    end
end
